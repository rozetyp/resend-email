<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Resend BYOK - Send Emails Your Way</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Bring your own Resend API key. Compose and send emails instantly. Your key stays in your browser. Transparent, minimal, fast." />
  <meta property="og:title" content="Resend BYOK - Send Emails Your Way" />
  <meta property="og:description" content="Bring your own key. Send emails instantly. Your data, your control." />
  <meta property="og:type" content="website" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pell@1.0.2/dist/pell.min.css" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      margin: 0;
      padding: 1rem;
      min-height: 100vh;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    .hero {
      text-align: center;
      margin-bottom: 2rem;
      padding: 2rem 1rem;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    }
    .hero h1 {
      font-size: 2.5rem;
      font-weight: 700;
      margin: 0 0 0.5rem 0;
      background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero p {
      font-size: 1.1rem;
      color: #555;
      margin: 0.5rem 0 2rem 0;
      line-height: 1.6;
    }
    .trust-badge {
      display: inline-block;
      background: #e0f2fe;
      color: #0369a1;
      padding: 0.75rem 1.5rem;
      border-radius: 999px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      border: 1px solid #bae6fd;
    }
    .form-card {
      background: #fff;
      border-radius: 16px;
      padding: 2rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
      margin-bottom: 1rem;
    }
    .form-section {
      margin-bottom: 1.5rem;
    }
    .form-section h3 {
      font-size: 0.9rem;
      font-weight: 600;
      color: #333;
      margin: 0 0 0.75rem 0;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    label { 
      display: block; 
      font-size: 0.9rem; 
      margin-bottom: 0.25rem; 
      font-weight: 600;
      color: #333;
    }
    input, textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid #d0d0d5;
      margin-bottom: 0.75rem;
      font: inherit;
      transition: border-color 0.2s;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: #2563eb;
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }
    button {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
    }
    .btn-primary {
      background: #2563eb;
      color: white;
      width: 100%;
    }
    .btn-primary:hover {
      background: #1d4ed8;
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }
    .btn-secondary {
      background: #f3f4f6;
      color: #333;
      margin-right: 0.5rem;
    }
    .btn-secondary:hover {
      background: #e5e7eb;
    }
    .alert {
      padding: 0.75rem 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      font-size: 0.9rem;
    }
    .alert-error {
      background: #fee2e2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }
    .alert-success {
      background: #dcfce7;
      color: #166534;
      border: 1px solid #bbf7d0;
    }
    .alert-info {
      background: #dbeafe;
      color: #0c4a6e;
      border: 1px solid #bae6fd;
    }
    .pell {
      border: 1px solid #d0d0d5;
      border-radius: 8px;
      min-height: 200px;
      margin-bottom: 0.75rem;
    }
    .pell-content {
      outline: none;
      padding: 0.75rem;
      min-height: 180px;
    }
    .pell-button {
      color: #000;
      font-weight: 600;
      cursor: pointer;
    }
    #preview {
      border: 1px solid #e5e7eb;
      padding: 1rem;
      border-radius: 8px;
      background: #fafafa;
      margin-top: 1rem;
    }
    .preview-header {
      font-weight: 700;
      margin-bottom: 0.75rem;
      color: #333;
    }
    .domain-chips {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }
    .chip {
      background: #eef2ff;
      border: 1px solid #c7d2fe;
      padding: 0.5rem 1rem;
      border-radius: 999px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    .chip:hover {
      background: #e0e7ff;
      border-color: #a5b4fc;
    }
    .footer {
      text-align: center;
      padding: 1rem;
      color: #999;
      font-size: 0.85rem;
    }
    .footer a {
      color: #2563eb;
      text-decoration: none;
    }
    .footer a:hover {
      text-decoration: underline;
    }
    @media (max-width: 640px) {
      .hero h1 { font-size: 1.8rem; }
      .form-card { padding: 1.5rem; }
      .hero { padding: 1.5rem 1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- HERO SECTION -->
    <div class="hero">
      <div class="trust-badge">üîê Your key stays in your browser</div>
      <h1>Resend BYOK</h1>
      <p>Send emails your way.<br/>Paste your key. Compose. Send. Done.</p>
    </div>

    <!-- MAIN FORM -->
    <div class="form-card">
      {% if error %}
      <div class="alert alert-error">{{ error }}</div>
      {% endif %}
      {% if result and not error %}
      <div class="alert alert-success">‚úì Email sent! ID: {{ result.get('id') if result else '' }}</div>
      {% endif %}

      <form method="post" action="/send">
        <!-- Hidden API KEY field (populated from password input) -->
        <input type="hidden" id="api_key_hidden" name="api_key" value="" />
        
        <!-- API KEY SECTION (hidden after submission) -->
        <div class="form-section" id="key_section">
          <h3>API Key</h3>
          <input type="password" id="api_key" placeholder="re_xxxxxxxxxxxxx" style="font-family: monospace;" />
          <div class="alert alert-info">
            ‚ÑπÔ∏è Your API key is used only for this request. We never store it.
          </div>
        </div>

        <!-- EMAIL COMPOSITION SECTION -->
        <div class="form-section">
          <h3>From</h3>
          <label for="from_email">Sender Email</label>
          <input id="from_email" name="from_email" type="text" value="{{ default_from or '' }}" placeholder="no-reply@yourdomain.com" required />
          {% if domains %}
          <div class="domain-chips">
            {% for d in domains %}
            <span class="chip" data-domain="{{ d }}">{{ d }}</span>
            {% endfor %}
          </div>
          <label style="font-size:0.85rem;color:#666;display:flex;align-items:center;gap:.4rem;">
            <input id="lock_from" type="checkbox"/> Lock domain
          </label>
          {% endif %}
        </div>

        <div class="form-section">
          <label for="to_email">To</label>
          <input id="to_email" name="to_email" type="email" value="{{ last_to or '' }}" placeholder="recipient@example.com" required />
        </div>

        <div class="form-section">
          <label for="subject">Subject</label>
          <input id="subject" name="subject" type="text" value="{{ last_subject or '' }}" placeholder="Email subject" required />
        </div>

        <div class="form-section">
          <label for="body">Email Body</label>
          <div id="pell" class="pell"></div>
          <input type="hidden" id="body" name="body" value="{{ last_body or '' }}" />
        </div>

        <!-- PREVIEW SECTION -->
        <div id="preview" style="display:none;">
          <div class="preview-header">Email Preview</div>
          <div id="preview_content"></div>
        </div>

        <!-- ACTION BUTTONS -->
        <div style="display:flex;gap:.5rem;margin-top:1.5rem;">
          <button type="button" class="btn-secondary" id="preview_btn">üëÅÔ∏è Preview</button>
          <button type="submit" class="btn-primary">Send Email</button>
        </div>
      </form>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <p>
        <strong>Transparent & Open Source</strong><br/>
        <a href="https://github.com/rozetyp/resend-email" target="_blank">View Code on GitHub</a> ‚Ä¢ 
        <a href="https://resend.com" target="_blank">Powered by Resend</a>
      </p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/pell@1.0.2/dist/pell.js"></script>
  <script>
    (function(){
      // Initialize Pell editor
      const pellEditor = window.pell.init({
        element: document.getElementById('pell'),
        onChange: function(html) {
          document.getElementById('body').value = html;
        },
        defaultParagraphSeparator: 'p',
        actions: [
          'bold',
          'italic',
          'underline',
          'heading1',
          'heading2',
          'olist',
          'ulist',
          { name: 'link', result: () => { const url = prompt('Enter URL'); if(url) window.pell.exec('createLink', url); } },
          { name: 'code', result: () => window.pell.exec('formatBlock', '<pre>') }
        ]
      });

      // Style toolbar buttons black text
      const buttons = document.querySelectorAll('.pell-button');
      buttons.forEach(btn => {
        btn.style.color = '#000';
        btn.style.fontWeight = '600';
        btn.style.cursor = 'pointer';
      });

      // Pre-populate editor if there's saved content
      if(document.getElementById('body').value){
        pellEditor.content.innerHTML = document.getElementById('body').value;
      }

      const sel = document.getElementById('domain_select');
      const from = document.getElementById('from_email');
      const lock = document.getElementById('lock_from');
      const chips = document.querySelectorAll('.chip');
      const preview = document.getElementById('preview');
      const previewContent = document.getElementById('preview_content');
      const previewBtn = document.getElementById('preview_btn');

      function setFrom(val){
        if (!from) return;
        from.value = val;
      }

      // Domain chip click handler
      chips.forEach(c => c.addEventListener('click', function(){
        const d = this.dataset.domain;
        if(!d) return;
        const val = 'no-reply@' + d;
        if(lock && lock.checked){
          setFrom(val);
        } else {
          setFrom(val);
        }
      }));

      function renderPreview(){
        const subjectEl = document.getElementById('subject');
        const toEl = document.getElementById('to_email');
        const fromEl = document.getElementById('from_email');
        const subj = subjectEl ? subjectEl.value : '';
        const to = toEl ? toEl.value : '';
        const fr = fromEl ? fromEl.value : '';
        let hdr = '<div style="margin-bottom:.75rem;padding:.5rem;border-radius:6px;background:#f8fafc;border:1px solid #e6eef8;">';
        hdr += '<div style="font-weight:700;margin-bottom:.25rem;">' + (subj||'(no subject)') + '</div>';
        hdr += '<div style="font-size:.9rem;color:#666">From: ' + (fr||'(no from)') + '</div>';
        hdr += '<div style="font-size:.9rem;color:#666">To: ' + (to||'(no to)') + '</div>';
        hdr += '</div>';
        const bodyContent = (pellEditor && pellEditor.content) ? pellEditor.content.innerHTML : document.getElementById('body').value;
        previewContent.innerHTML = hdr + (bodyContent || '<i style="color:#999;">(empty body)</i>');
      }

      // Preview button
      previewBtn && previewBtn.addEventListener('click', function(e){
        e.preventDefault();
        if(!preview) return;
        if(preview.style.display==='none'){
          renderPreview();
          preview.style.display = 'block';
          preview.scrollIntoView({behavior:'smooth', block:'center'});
          this.textContent = '‚úì Preview';
        } else {
          preview.style.display = 'none';
          this.textContent = 'üëÅÔ∏è Preview';
        }
      });

      // Form submit
      const form = document.querySelector('form');
      if(form){
        form.addEventListener('submit', function(e){
          // Sync Pell content to hidden body input
          document.getElementById('body').value = pellEditor.content.innerHTML;
          
          // Sync API key from password input to hidden input
          const apiKeyInput = document.getElementById('api_key');
          const apiKeyHidden = document.getElementById('api_key_hidden');
          if(apiKeyInput && apiKeyHidden){
            apiKeyHidden.value = apiKeyInput.value;
          }
          
          if(!pellEditor.content.innerHTML.trim()){
            e.preventDefault();
            alert('Email body cannot be empty');
          }
        });
      }
    })();
  </script>
</body>
</html>
